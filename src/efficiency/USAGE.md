# æ•ˆç‡ä¼˜åŒ–æ¨¡å— - ä½¿ç”¨æŒ‡å—

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•è¿è¡Œæ•ˆç‡ä¼˜åŒ–æ¨¡å—çš„å®Œæ•´å®éªŒå’ŒæŸ¥çœ‹ç»“æœã€‚

---

## 1ï¸âƒ£ å‰ç½®è¦æ±‚

ç¡®ä¿å·²å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š

```bash
# 1. æ•°æ®å‡†å¤‡
cd /path/to/bank-marketing-imbalanced
python src/data_prep.py

# 2. baselineåŸºçº¿æµ‹è¯•ï¼ˆå¯é€‰ï¼Œä½†å»ºè®®ï¼‰
python src/baseline.py

# 3. effectæ•ˆæœä¼˜åŒ–ï¼ˆå¿…é¡»å…ˆå®Œæˆï¼Œå› ä¸ºefficiencyä¾èµ–å…¶æ¨¡å‹ï¼‰
python src/effect.py
```

éªŒè¯è¾“å‡ºæ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼š
- âœ“ `data/processed/X_train.npy`, `X_val.npy`, `X_test.npy`
- âœ“ `data/processed/y_train.npy`, `y_val.npy`, `y_test.npy`
- âœ“ `outputs/results_effect.csv`

---

## 2ï¸âƒ£ è¿è¡Œæ•ˆç‡ä¼˜åŒ–å®éªŒ

### æ–¹å¼ä¸€ï¼šç›´æ¥æ‰§è¡Œï¼ˆæ¨èï¼‰

```bash
cd /path/to/bank-marketing-imbalanced
python src/efficiency.py
```

è¿™ä¼šè‡ªåŠ¨è¿è¡Œå®Œæ•´çš„ 3 å±‚å¯¹æ¯”å®éªŒï¼š
1. **Baselineå±‚**ï¼šåŸå§‹RFæ¨¡å‹ï¼ˆ200æ£µæ ‘ï¼‰
2. **Effectå±‚**ï¼šåŠ å…¥æˆæœ¬æ•æ„Ÿå’Œå¯†åº¦åŠ æƒçš„RFï¼ˆ200æ£µæ ‘ï¼‰
3. **Efficiencyå±‚**ï¼šå¯¹Effectå±‚æ¨¡å‹è¿›è¡ŒK-Meansèšç±»å’Œæ ‘å‰ªæï¼ˆæœ€ç»ˆ~10æ£µæ ‘ï¼‰

### æ–¹å¼äºŒï¼šPythonè„šæœ¬ä¸­å¯¼å…¥

```python
from src.efficiency.run_efficiency import main

main()  # è¿è¡Œå®Œæ•´å®éªŒ
```

---

## 3ï¸âƒ£ è¿è¡Œè¿‡ç¨‹è§£æ

æ‰§è¡Œ `python src/efficiency.py` æ—¶ï¼Œä½ ä¼šçœ‹åˆ°å¦‚ä¸‹è¾“å‡ºæµç¨‹ï¼š

### é˜¶æ®µ1ï¼šBASELINEï¼ˆæ— ä¼˜åŒ–ï¼‰
```
================================================================================
LAYER 1: BASELINE (No optimization)
================================================================================
Train time: 1.2345s
Pred time: 0.0234s
Recall: 0.6850
F1: 0.5234
G-mean: 0.7123
Threshold: 0.5000
```

**å«ä¹‰**ï¼š
- æ ‡å‡†éšæœºæ£®æ—ï¼ˆ200æ£µæ ‘ï¼‰çš„æ€§èƒ½åŸºå‡†
- æ‰€æœ‰åç»­ä¼˜åŒ–éƒ½ä¸æ­¤å¯¹æ¯”

### é˜¶æ®µ2ï¼šEFFECTï¼ˆæ•ˆæœä¼˜åŒ–å±‚ï¼‰
```
================================================================================
LAYER 2: EFFECT (Cost-sensitive + Density weighting)
================================================================================
Train time: 1.5678s
Pred time: 0.0256s
Recall: 0.7234
F1: 0.5678
G-mean: 0.7456
Threshold: 0.4821
```

**å«ä¹‰**ï¼š
- åº”ç”¨äº†cost-sensitiveå­¦ä¹ ï¼ˆæ­£ç±»æƒé‡ï¼š4.0ï¼‰
- åº”ç”¨äº†å¯†åº¦æ„ŸçŸ¥æ ·æœ¬åŠ æƒï¼ˆk=5, alpha=5.0ï¼‰
- æ€§èƒ½æå‡ï¼šRecallå’ŒF1é€šå¸¸ä¼šå¢åŠ 
- é¢„æµ‹æ—¶é—´ç•¥é•¿ï¼ˆæ›´å¤šæ ·æœ¬åŠ æƒè®¡ç®—ï¼‰

### é˜¶æ®µ3ï¼šEFFICIENCYï¼ˆæ•ˆç‡ä¼˜åŒ–å±‚ï¼‰
```
================================================================================
LAYER 3: EFFICIENCY (Effect + Tree Pruning)
================================================================================
Original trees: 200
Selected trees after pruning: 10
Compression ratio: 5.00%
Tree indices: [5, 23, 45, 67, 89, 103, 145, 167, 189, 198]
Tree weights: [0.153, 0.089, 0.125, 0.067, 0.078, 0.112, 0.095, 0.141, 0.088, 0.052]

Train time: 1.5678s (inherited from Effect)
Pred time: 0.0035s
Recall: 0.7102
F1: 0.5612
G-mean: 0.7389
Threshold: 0.4905
```

**å«ä¹‰**ï¼š
- ä»200æ£µæ ‘é™è‡³10æ£µï¼ˆå‹ç¼©æ¯”5%ï¼‰
- é€‰ä¸­çš„10æ£µæ ‘é€šè¿‡K-Meansèšç±»å’ŒF1å¾—åˆ†é€‰æ‹©
- é¢„æµ‹æ—¶é—´ä»0.0256sé™è‡³0.0035sï¼ˆ**7å€åŠ é€Ÿ**ï¼‰
- æ€§èƒ½æŸå¤±å¾ˆå°ï¼ˆRecall: 0.7234 â†’ 0.7102ï¼‰

---

## 4ï¸âƒ£ è¾“å‡ºæ–‡ä»¶è¯¦è§£

è¿è¡Œå®Œæ¯•åï¼Œåœ¨ `outputs/` ç›®å½•ä¸‹ä¼šç”Ÿæˆï¼š

### CSVç»“æœæ–‡ä»¶
**æ–‡ä»¶**ï¼š`outputs/results_efficiency.csv`

```csv
method,train_time_s,pred_time_s,recall,f1,gmean,threshold,n_trees
Baseline (RF only),1.2345,0.0234,0.6850,0.5234,0.7123,0.5000,200
Effect (CW4.0+Density),1.5678,0.0256,0.7234,0.5678,0.7456,0.4821,200
Efficiency (Pruned to 10 trees),1.5678,0.0035,0.7102,0.5612,0.7389,0.4905,10
```

**åˆ—è¯´æ˜**ï¼š
- `method`ï¼šæ–¹æ³•åç§°ï¼ˆç”¨äºå¯¹æ¯”ï¼‰
- `train_time_s`ï¼šæ¨¡å‹è®­ç»ƒè€—æ—¶ï¼ˆç§’ï¼‰
- `pred_time_s`ï¼šå•æ¬¡é¢„æµ‹è€—æ—¶ï¼ˆç§’ï¼‰
- `recall`ï¼šæ­£ç±»å¬å›ç‡ï¼ˆè¶Šé«˜è¶Šå¥½ï¼‰
- `f1`ï¼šF1å¾—åˆ†ï¼ˆç»¼åˆæŒ‡æ ‡ï¼‰
- `gmean`ï¼šå‡ ä½•å‡å€¼ï¼ˆå¹³è¡¡æŒ‡æ ‡ï¼‰
- `threshold`ï¼šå†³ç­–é˜ˆå€¼ï¼ˆé€šè¿‡éªŒè¯é›†è°ƒä¼˜ï¼‰
- `n_trees`ï¼šä½¿ç”¨çš„æ ‘æ•°é‡

### å¯è§†åŒ–æ–‡ä»¶

#### ğŸ“Š ROCæ›²çº¿å¯¹æ¯”
**æ–‡ä»¶**ï¼š`outputs/roc_comparison_3layer.png`

å±•ç¤ºä¸‰ä¸ªæ¨¡å‹çš„ROCæ›²çº¿ï¼š
- çº¢è‰²æ›²çº¿ï¼šBaseline
- æ©™è‰²æ›²çº¿ï¼šEffect
- ç»¿è‰²æ›²çº¿ï¼šEfficiency

**è§£è¯»**ï¼š
- ROCæ›²çº¿è¶Šæ¥è¿‘å·¦ä¸Šè§’ï¼Œæ¨¡å‹è¶Šå¥½
- AUCå€¼è¶Šé«˜ï¼Œåˆ†ç±»èƒ½åŠ›è¶Šå¼º
- Effectå’ŒEfficiencyåº”è¯¥è¶…è¿‡Baseline

#### â±ï¸ æ—¶é—´å¯¹æ¯”
**æ–‡ä»¶**ï¼š`outputs/time_comparison_3layer.png`

åŒ…å«ä¸¤ä¸ªå­å›¾ï¼š
1. **å·¦å›¾**ï¼šè®­ç»ƒæ—¶é—´ & é¢„æµ‹æ—¶é—´æŸ±çŠ¶å›¾
2. **å³å›¾**ï¼šæ¨ç†åŠ é€Ÿæ¯”ï¼ˆç›¸å¯¹äºBaselineï¼‰

**è§£è¯»**ï¼š
- é¢„æµ‹æ—¶é—´è¶ŠçŸ­è¶Šå¥½
- Efficiencyçš„é¢„æµ‹æ—¶é—´åº”æ˜¾è‘—ä½äºå…¶ä»–ä¸¤ä¸ª
- åŠ é€Ÿæ¯” = Baselineé¢„æµ‹æ—¶é—´ / è¯¥æ–¹æ³•é¢„æµ‹æ—¶é—´

#### ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡å¯¹æ¯”
**æ–‡ä»¶**ï¼š`outputs/metrics_comparison_3layer.png`

ä¸‰ç»„æŸ±çŠ¶å›¾å¯¹æ¯”ï¼š
- Recallï¼ˆæ­£ç±»å¬å›ç‡ï¼‰
- F1-Scoreï¼ˆç»¼åˆè¯„åˆ†ï¼‰
- G-meanï¼ˆå‡ ä½•å‡å€¼ï¼‰

**è§£è¯»**ï¼š
- ä¸‰ä¸ªæŒ‡æ ‡éƒ½è¶Šé«˜è¶Šå¥½
- Effectåº”è¯¥å…¨é¢è¶…è¿‡Baseline
- Efficiencyå¯èƒ½ç•¥ä½äºEffectï¼Œä½†ä»£ä»·æ˜¯æ¨ç†é€Ÿåº¦å¤§å¹…æå‡

---

## 5ï¸âƒ£ æ ¸å¿ƒå‚æ•°è°ƒæ•´

åœ¨ `src/efficiency/run_efficiency.py` ä¸­çš„ `EfficiencyConfig` ç±»å¯è°ƒæ•´å‚æ•°ï¼š

### èšç±»å‚æ•°
```python
n_clusters: int = 10  # èšç±»ç°‡æ•°ï¼ˆå¢åŠ â†’æ›´å¤šæ ‘è¢«ä¿ç•™ï¼Œæ€§èƒ½æ›´å¥½ä½†é€Ÿåº¦æ›´æ…¢ï¼‰
```

**å»ºè®®**ï¼š
- æ ‘æ•°å°‘ï¼ˆ<100ï¼‰ï¼šn_clusters = 5-7
- æ ‘æ•°é€‚ä¸­ï¼ˆ100-200ï¼‰ï¼šn_clusters = 10-15
- æ ‘æ•°å¤šï¼ˆ>200ï¼‰ï¼šn_clusters = 20-30

### Effectå±‚å‚æ•°ï¼ˆç»§æ‰¿è‡ªeffectæ¨¡å—ï¼‰
```python
pos_class_weight: float = 4.0          # æ­£ç±»æˆæœ¬æƒé‡
knn_k: int = 5                          # å¯†åº¦åŠ æƒçš„Kå€¼
density_alpha: float = 5.0              # å¯†åº¦åŠ æƒå¼ºåº¦
use_class_weight: bool = True           # æ˜¯å¦å¯ç”¨æˆæœ¬æ•æ„Ÿ
use_density: bool = True                # æ˜¯å¦å¯ç”¨å¯†åº¦åŠ æƒ
```

### é˜ˆå€¼è°ƒä¼˜å‚æ•°
```python
threshold_objective: str = "f1"  # ä¼˜åŒ–ç›®æ ‡ï¼š"f1" æˆ– "recall"
t_min: float = 0.05              # é˜ˆå€¼æœç´¢æœ€å°å€¼
t_max: float = 0.95              # é˜ˆå€¼æœç´¢æœ€å¤§å€¼
t_step: float = 0.01             # é˜ˆå€¼æœç´¢æ­¥é•¿
```

---

## 6ï¸âƒ£ å®Œæ•´å·¥ä½œæµç¤ºä¾‹

```bash
# 1. å‡†å¤‡æ•°æ®
python src/data_prep.py

# 2. è¿è¡Œbaselineï¼ˆå¯é€‰ä½†æ¨èï¼‰
python src/baseline.py

# 3. è¿è¡Œeffectä¼˜åŒ–ï¼ˆå¿…é¡»ï¼‰
python src/effect.py

# 4. è¿è¡Œefficiencyä¼˜åŒ–
python src/efficiency.py

# 5. æŸ¥çœ‹ç»“æœ
cat outputs/results_efficiency.csv
open outputs/roc_comparison_3layer.png
open outputs/time_comparison_3layer.png
open outputs/metrics_comparison_3layer.png
```

---

## 7ï¸âƒ£ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆEfficiencyçš„æ€§èƒ½æ¯”Effectç•¥ä½ï¼Ÿ
**A**: è¿™æ˜¯å‰ªæçš„å¿…ç„¶æƒè¡¡ã€‚é€šè¿‡å‡å°‘æ ‘çš„æ•°é‡æ¥åŠ é€Ÿï¼Œä¼šæŸå¤±ä¸€äº›æ¨¡å‹å®¹é‡ã€‚é€šå¸¸F1ä¸‹é™<5%ï¼Œè€Œæ¨ç†é€Ÿåº¦æå‡5-10å€ã€‚

### Q: å¦‚ä½•è·å¾—æ›´å¿«çš„Efficiencyæ¨¡å‹ï¼Ÿ
**A**: å‡å° `n_clusters` å‚æ•°ï¼Œä¾‹å¦‚æ”¹ä¸º 5 æˆ– 7ã€‚è¿™ä¼šé€‰å‡ºæ›´å°‘çš„æ ‘ï¼Œé€Ÿåº¦æ›´å¿«ä½†ç²¾åº¦ä¸‹é™æ›´å¤šã€‚

### Q: ä¸ºä»€ä¹ˆé¢„æµ‹æ—¶é—´çš„å·®å¼‚è¿™ä¹ˆå¤§ï¼Ÿ
**A**: 
- Baseline & Effectï¼šé¢„æµ‹200æ£µæ ‘çš„æ¦‚ç‡ â†’ æ±‚å¹³å‡
- Efficiencyï¼šä»…é¢„æµ‹10æ£µæ ‘ â†’ åŠ æƒæ±‚å’Œ
- æ¨ç†æ—¶é—´ä¸æ ‘æ•°é‡çº¿æ€§ç›¸å…³

### Q: èƒ½å¦ä¿®æ”¹å·²ä¿å­˜çš„æ¨¡å‹ï¼Ÿ
**A**: Efficiencyæ¨¡å—ä¾èµ–Effectçš„è®­ç»ƒæ¨¡å‹ã€‚å¦‚éœ€ä¿®æ”¹ï¼Œè¯·å…ˆé‡æ–°è¿è¡Œ `python src/effect.py`ã€‚

### Q: å¦‚ä½•åªæµ‹è¯•æŸä¸€å±‚ï¼Ÿ
**A**: ä¿®æ”¹ `src/efficiency/run_efficiency.py` ä¸­çš„ `main()` å‡½æ•°ï¼Œæ³¨é‡Šæ‰ä¸éœ€è¦çš„å±‚ã€‚

---

## 8ï¸âƒ£ æ€§èƒ½ä¼˜åŒ–æŠ€å·§

### å¯¹äºå¤§æ•°æ®é›†
1. å¢åŠ  `n_clusters` ä»¥ä¿ç•™æ›´å¤šæ ‘
2. å¢åŠ  `t_step` ä»¥åŠ å¿«é˜ˆå€¼æœç´¢ï¼ˆç²¾åº¦æ¢é€Ÿåº¦ï¼‰
3. è®¾ç½® `n_jobs = -1` ä»¥å¯ç”¨å¤šçº¿ç¨‹

### å¯¹äºå®æ—¶åº”ç”¨
1. å‡å° `n_clusters` åˆ°æœ€ä½å¯æ¥å—æ°´å¹³
2. ä½¿ç”¨å›ºå®šé˜ˆå€¼è€Œä¸è¿›è¡Œé˜ˆå€¼è°ƒä¼˜
3. ç¦»çº¿é¢„è®¡ç®—æ‰€æœ‰å‰å‘ä¼ æ’­ç»“æœï¼ˆå¦‚é€‚ç”¨ï¼‰

### å¯¹äºæœ€å¤§æ€§èƒ½
1. ä¿ç•™æ‰€æœ‰ `n_clusters = n_estimators / 2`
2. å¯ç”¨æ‰€æœ‰ä¼˜åŒ–ï¼š`use_class_weight=True`, `use_density=True`
3. åœ¨éªŒè¯é›†ä¸Šå……åˆ†è°ƒä¼˜é˜ˆå€¼

---

## 9ï¸âƒ£ éªŒè¯ç»“æœçš„æ ‡å‡†

ä¸€ä¸ªæˆåŠŸçš„Efficiencyä¼˜åŒ–åº”è¯¥æ»¡è¶³ï¼š

âœ… **Recallå˜åŒ– < 5%**
  - Effect Recall: 0.7234 â†’ Efficiency Recall: 0.7102
  - å˜åŒ–ç‡: 1.8% âœ“

âœ… **F1å˜åŒ– < 5%**
  - Effect F1: 0.5678 â†’ Efficiency F1: 0.5612
  - å˜åŒ–ç‡: 1.2% âœ“

âœ… **é¢„æµ‹æ—¶é—´è‡³å°‘åŠ é€Ÿ 3 å€**
  - Effect: 0.0256s â†’ Efficiency: 0.0035s
  - åŠ é€Ÿæ¯”: 7.3x âœ“

âœ… **æ¨¡å‹å‹ç¼©è‡³å°‘ 50%**
  - 200 â†’ 10 trees = 5% âœ“

---

## ğŸ”Ÿ è·å–å¸®åŠ©

å¦‚é‡åˆ°é—®é¢˜ï¼Œæ£€æŸ¥ä»¥ä¸‹æ–‡ä»¶ï¼š
1. **IMPLEMENTATION.md** - è¯¦ç»†çš„ç®—æ³•å®ç°è¯´æ˜
2. **src/efficiency/models.py** - TreePrunerç±»çš„æºä»£ç 
3. **src/efficiency/run_efficiency.py** - å®Œæ•´å®éªŒæµç¨‹
4. **outputs/results_efficiency.csv** - æ•°å€¼ç»“æœ

---

**æœ€åæ›´æ–°**ï¼š2025å¹´12æœˆ21æ—¥
**ä½œè€…**ï¼šAI Assistant
**é¡¹ç›®**ï¼šBank Marketing Imbalanced Classification
